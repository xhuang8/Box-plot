<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <!--<title>Data set for trading</title>-->

    <style>
        body {
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        }

        .box {
            font: 10px sans-serif;
        }

        .box line,
        .box rect,
        .box circle {
            fill: cadetblue;
            stroke: black;
            stroke-width: 1.5px;
        }

        .box .center {
            stroke-dasharray: 2,3;
        }

        .box .outlier {
            fill: none;
            stroke: black;
        }

        .axis {
            font: 12px "Helvetica Neue";
        }

        .axis path,
        .axis line {
            fill: none;
            stroke: black;
            shape-rendering: crispEdges;
        }

        .x.axis path {
            fill: none;
            stroke: black;
            shape-rendering: crispEdges;
        }
    </style>
</head>


<body>
<!--load d3.js-->
<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="./box.js"></script>


<script>

    var labels = true;

    //set the dimensions and margins of the graph
    var margin  = {top: 30, right: 50, bottom: 112, left: 50},
        width = 800 - margin.left - margin.right,
        height = 400 - margin.top - margin.bottom;

    var min = Infinity,
        max = -Infinity;

    <!--
    /append the svg object to the body of the page
    var svg = d3.select("#my_box")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
    -->

    //read and parse data for csv file
    //to draw the box, we have to use the some information which like quartiles, median, inter quartile range min and max
    d3.csv("data.csv", function (error, csv) {

        if(error) {
            console.log(error);
        }
        console.log(csv);

        var data = [];


        //csv is kind like array, using the array with data [i][2] to match with csv file
         data[1] = [];
         data[2] = [];
         data[3] = [];
         data[4] = [];
         data[5] = [];
         data[6] = [];
        //it shows the data in the ith column in the csv file

        //showing the header of the csv file
        data[1][0] = "open";
        data[2][0] = "high";
        data[3][0] = "low";
        data[4][0] = "close";
        data[5][0] = "adj_close";
        data[6][0] = "volume";

        data[1][1] = [];
        data[2][1] = [];
        data[3][1] = [];
        data[4][1] = [];
        data[5][1] = [];
        data[6][1] = [];

        csv.forEach(function (x) {
            var v1 = Math.floor(x.open),
                v2 = Math.floor(x.high),
                v3 = Math.floor(x.low),
                v4 = Math.floor(x.close),
                v5 = Math.floor(x.adj_close),
                v6 = Math.floor(x.volume);

            arr = [v1, v2, v3, v4, v5, v6]
            var rowMax = Math.max(v1, v2, v3, v4, v5, v6);
            var rowMin = Math.min(v1, v2, v3, v4, v5, v6);

            data[1][1].push(v1);
            data[2][1].push(v2);
            data[3][1].push(v3);
            data[4][1].push(v4);
            data[5][1].push(v5);
            data[6][1].push(v6);

            if(rowMax > max)
                max = rowMax;
            if(rowMin < min)
                min = rowMin;

            //max values
            max = 10000000;
            console.log(data);
        });

        //initial the box plot
        var chart = d3.box()
            .whiskers(iqr(1.5))
            .height(height)
            .domain([min, max])
            .showLabels(labels);

        var svg = d3.select("body").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .attr("class", "box")
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");



        //define x-axis
        var x = d3.scaleOrdinal()
            .domain(data.map(function (d) {
                return d[1]
            }))
            .rangeRound([0, width]);

        var xAxis = d3.axisBottom()
            .scale(x);



        //define y-axis
        var y = d3.scaleLinear()
            .domain([min, max])
            .range([height + margin.top, 0 + margin.top]);

        var yAxis = d3.axisLeft()
            .scale(y);



        //draw the box plots
        svg.selectAll(".box")
            .data(data)
            .enter().append("g")
            .attr("transform", function(d) { return "translate(" +  x(d[0])  + "," + margin.top + ")"; } )
            .call(chart.width(x.bandwidth()));

        //adding the title for box-plot
        svg.append("text")
            .attr("x", (width/2))
            .attr("y", 0 + (margin.top/2))
            .attr("text-anchor", "middle")
            .style("font-size", "18px")
            .text("Data set for trading in 2019");

        //draw y axis
        svg.append("g")
            .attr("class", "y axis")
            .call(yAxis)
            .append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", -35)
            .attr("x", -28)
            .attr("dy", ".71em")
            .style("text-anchor", "end")
            .style("font-size", "13px")
            .style("font-weight", "bold")
            .text("Response Time [Minutes]");

        //draw x axis
        svg.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + (height  + margin.top + 10) + ")")
            .call(xAxis)
            .append("text")             // text label for the x axis
            .attr("x", (width / 2) )
            .attr("y",  40 )
            .attr("dy", ".71em")
            .style("text-anchor", "middle")
            .style("font-size", "13px")
            .style("font-weight", "bold")
            .text("Call Type");
    });

    function iqr(k) {
        return function (d, i) {
            var q1 = d.quartiles[0],
                q3 = d.quartiles[2],
                iqr = (q3 - q1) * k,
                i = -1,
                j = d.length;
            while(d[++i] < q1 - iqr);
            while(d[--j] > q3 + iqr);
            return [i, j];
        };
    }

</script>

</body>
</html>